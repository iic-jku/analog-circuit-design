## Exemplary Examination Questions {#sec-exam-questions}

{{< include ..//_macros.qmd >}}

This appendix contains a collection of exemplary examination questions covering the main topics of this course. The questions are organized by topic and include both conceptual understanding and quantitative problem-solving.

---

### MOSFET Fundamentals

::: {.callout-note title="Question 1.1 --- Small-Signal Parameters" collapse="true"}
**Question:** Define the two main small-signal parameters of a MOSFET ($\gm$ and $\gds$) and explain their physical meaning.

**Solution:**

- **Transconductance** $\gm = {\partial \ID}/{\partial \VGS}$: Describes how the drain current changes with gate-source voltage. It represents the amplification capability of the transistor.

- **Output conductance** $\gds = {\partial \ID}/{\partial \VDS} = r_\mathrm{out}^{-1}$: Describes how the drain current varies with drain-source voltage (ideally zero in saturation, but finite due to channel-length modulation). It limits the maximum achievable voltage gain. In the triode region, $\gds$ is the resistance of the channel, which can be electrically controlled by $\VGS$.
:::

::: {.callout-note title="Question 1.2 --- Operating Regions" collapse="true"}
**Question:** State the conditions for a MOSFET to operate in the triode region versus the saturation region. Why is saturation preferred for analog amplifier design?

**Solution:**

- **Triode region:** $\VDS < V_\mathrm{ds,sat}$
- **Saturation region:** $\VDS \geq V_\mathrm{ds,sat}$

Saturation is preferred for analog amplifiers because:

1. The drain current is largely independent of $\VDS$, resulting in high output impedance ($r_\mathrm{out} = 1 / \gds$)
2. The transistor acts as a voltage-controlled current source
3. High intrinsic gain ($\gm / \gds$) can be achieved
4. Linear relationship between small-signal input voltage and output current given by $\gm$

The triode region is important when operating the MOSFET as a (variable) resistor or switch.
:::

::: {.callout-note title="Question 1.3 --- Transit Frequency" collapse="true"}
**Question:** Define the transit frequency $f_\mathrm{T}$ of a MOSFET. How does it relate to the transistor's speed capability?

**Solution:**

The transit frequency is defined as:
$$f_\mathrm{T} = \frac{\gm}{2\pi \Cgg} = \frac{\gm}{2\pi (\Cgs + \Cgd + \Cgb)}$$

It represents the frequency at which the current gain of the transistor drops to unity. A higher $f_T$ indicates:

- Faster switching capability
- Higher potential bandwidth in amplifier applications
- Better high-frequency performance

The $f_\mathrm{T}$ increases with higher $\gm$ (higher bias current or larger $W/L$) and decreases with larger parasitic capacitances (larger device area).
:::

---

### gm/ID Sizing Methodology

::: {.callout-note title="Question 2.1 --- gm/ID in Different Inversion Regions" collapse="true"}
**Question:** Derive the theoretical limits of $\gmid$ in weak inversion ($\VGS$ small) and strong inversion ($\VGS$ large). What is the typical range of $\gmid$ used in practical analog design?

**Solution:**

**Weak inversion (subthreshold):**
$$\gmid = \frac{1}{n V_\mathrm{T}}$$
where $n \approx 1.2-1.5$ is the subthreshold slope factor and $V_\mathrm{T} = kT/q \approx 25.8\,\text{mV}$ at room temperature.

This gives $\gmid \approx 25-30\,\text{V}^{-1}$ as the maximum.

**Strong inversion (square-law approximation):**
$$\gmid = \frac{2}{\VGS - \Vth} = \frac{2}{V_\mathrm{od}}$$

For typical overdrive voltages of 100---300 mV, this gives $\gmid \approx 7-20\,\text{V}^{-1}$.

**Practical range:** $\gmid$ between 5 and 25 V$^{-1}$ is commonly used, with:

- High $\gmid$ (15---25 V$^{-1}$): Low power, but slower and larger area
- Medium $\gmid$ (8---15 V$^{-1}$): Balanced trade-off
- Low $\gmid$ (5---8 V$^{-1}$): High speed, but more current and headroom needed
:::

::: {.callout-note title="Question 2.2 --- Design Trade-offs" collapse="true"}
**Question:** Explain the trade-offs involved when choosing a high versus low $\gmid$ target in transistor sizing.

**Solution:**

| Parameter              | High $\gmid$ (>15)      | Low $\gmid$ (<8)             |
|------------------------|-------------------------|-------------------------------|
| Current consumption    | Lower (for same $\gm$)  | Higher                        |
| Speed ($f_\mathrm{T}$) | Lower                   | Higher                        |
| $V_\mathrm{ds,sat}$    | Lower                   | Higher (more headroom needed) |
| Operating region       | Weak/moderate inversion | Strong inversion              |

The choice depends on application requirements:

- For low-power applications: High $\gmid$
- For high-speed applications: Low $\gmid$
- For voltage headroom-limited designs: High $\gmid$ (lower $V_\mathrm{ds,sat}$)
:::

::: {.callout-note title="Question 2.3 --- Saturation Voltage" collapse="true"}
**Question:** A transistor is sized for $\gmid = 15\,\text{V}^{-1}$. Estimate the minimum $\VDS$ required to keep it in saturation.

**Solution:**

The saturation voltage can be estimated from:
$$V_\mathrm{ds,sat} \approx \frac{2}{\gmid} = \frac{2}{15} \approx 133\,\text{mV}$$

To ensure safe operation in saturation with some margin, a $\VDS$ of at least 150--200 mV should be allocated.

Note: This approximation is based on the strong inversion relationship and provides a reasonable estimate for moderate inversion as well.
:::

---

### MOSFET Diode

::: {.callout-note title="Question 3.1 --- Small-Signal Impedance" collapse="true"}
**Question:** Derive the small-signal impedance of a MOSFET diode (gate connected to drain) and identify its frequency behavior.

**Solution:**

For a MOSFET with gate shorted to drain, applying KCL at the drain node (we only keep $\gm$, $\gds$, and $\Cgs$ from the small-signal model):
$$i_\mathrm{test} = \gm \vgs + \gds \vds + s\Cgs \vgs$$

Since $\vgs = \vds = v_\mathrm{test}$:
$$i_\mathrm{test} = (\gm + \gds + s\Cgs) v_\mathrm{test}$$

Therefore:
$$Z_\mathrm{diode}(s) = \frac{v_\mathrm{test}}{i_\mathrm{test}} = \frac{1}{\gm + \gds + s\Cgs}$$

**At dc:** $Z_\mathrm{diode} \approx \frac{1}{\gm}$ (since $\gm \gg \gds$)

**Corner frequency:** $f_\mathrm{c} = \frac{\gm + \gds}{2\pi \Cgs} \approx \frac{\gm}{2\pi \Cgs} \approx f_T$

The impedance is resistive ($\approx 1/\gm$) at low frequencies and becomes capacitive at (very) high frequencies.
:::

::: {.callout-note title="Question 3.2 --- Noise Consideration" collapse="true"}
**Question:** What is the output noise voltage (RMS) of a MOSFET diode, and how does it relate to $kT/C$ noise?

**Solution:**

The integrated output noise of a MOSFET diode follows the $kT/C$ relationship:
$$V_\mathrm{n,rms}^2 = \frac{k T \gamma}{\Cgs}$$

where $\gamma$ is the thermal noise excess factor (approximately 2/3 for long-channel devices, higher for short-channel).

This is analogous to the $kT/C$ noise of an RC network, with the effective capacitance being $\Cgs$. To reduce noise:

- Increase $\Cgs$ (larger device)
- Note: Bandwidth also decreases with larger $\Cgs$
:::

---

### Current Mirror

::: {.callout-note title="Question 4.1 --- Basic Current Mirror" collapse="true"}
**Question:** For a basic NMOS current mirror with input transistor $M_1$ and output transistor $M_2$, derive the output current ratio. What are the main sources of error in a practical current mirror?

**Solution:**

**Ideal output current:**
$$I_\mathrm{out} = I_\mathrm{ref} \cdot \frac{(W/L)_2}{(W/L)_1}$$

**Main error sources:**

1. **Channel-length modulation:** Different $\VDS$ on $M_1$ and $M_2$ causes current mismatch
$$\frac{\Delta I}{I} \approx \frac{\Delta \VDS \cdot \gds}{\ID}$$

2. **Threshold voltage mismatch:** Random $\Delta\Vth$ variations
$$\frac{\Delta I}{I} \approx \frac{\gm \cdot \Delta \Vth}{\ID} = \gmid \cdot \Delta \Vth$$

3. **W/L mismatch:** Lithographic variations in device dimensions during manufacturing

4. **Temperature gradients:** Different operating temperatures for the transistors

5. **Finite output resistance:** Limits the current source quality ($r_\mathrm{out} = 1 / \gds$)
:::

::: {.callout-note title="Question 4.2 --- Output Resistance" collapse="true"}
**Question:** Calculate the output resistance of a simple current mirror. How can it be improved?

**Solution:**

**Simple current mirror:** $r_\mathrm{out} = r_\mathrm{ds} = \frac{1}{\gds}$

**Improvements:**

1. **Cascode current mirror:**
$$r_\mathrm{out} = r_\mathrm{ds,casc} + r_\mathrm{ds} \cdot (1 + \gm[,casc] \cdot r_\mathrm{ds,casc}) \approx \gm[,casc] \cdot r_\mathrm{ds,casc} \cdot r_\mathrm{ds}$$

2. **Source degeneration:**
$$r_\mathrm{out} = r_\mathrm{ds} + R_\mathrm{deg} \cdot (1 + \gm \cdot r_\mathrm{ds}) \approx \gm \cdot r_\mathrm{ds} \cdot R_\mathrm{deg}$$

3. **Regulated cascode:**
$$r_\mathrm{out} \approx r_\mathrm{ds} \cdot \gm[,casc] \cdot r_\mathrm{ds,casc} \cdot \gm[,aux] \cdot r_\mathrm{ds,aux}$$

The improvement factor for cascoding is approximately $\gm / \gds$ (intrinsic gain).
:::

::: {.callout-note title="Question 4.3 --- High-Swing Cascode" collapse="true"}
**Question:** Explain the principle of a high-swing (low-voltage) cascode current mirror. What is the minimum output voltage for proper operation?

**Solution:**

In a high-swing cascode, the bias voltage $V_\mathrm{bias}$ for the cascode transistor is chosen such that both the main transistor and the cascode transistor operate just at the edge of saturation:

$$V_\mathrm{bias} = V_\mathrm{GS[,casc]} + V_\mathrm{ds,sat,main}$$

**Minimum output voltage:**
$$V_\mathrm{out,min} = V_\mathrm{ds,sat,casc} + V_\mathrm{ds,sat,main} = 2 \cdot V_\mathrm{ds,sat}$$

For typical $\gmid = 15\,\text{V}^{-1}$: $V_\mathrm{out,min} \approx 2 \times 133\,\text{mV} \approx 270\,\text{mV}$

This is significantly lower than a standard cascode where $V_\mathrm{out,min} = \VGS + V_\mathrm{ds,sat}$ (typically >500 mV).
:::

---

### Differential Pair

::: {.callout-note title="Question 5.1 --- Differential vs. Common-Mode" collapse="true"}
**Question:** For an ideal differential pair with tail current source $I_\mathrm{tail}$, derive the differential-mode and common-mode transconductance.

**Solution:**

**Differential mode:** With $v_\mathrm{in,dm} = v_\mathrm{in,p} - v_\mathrm{in,n}$ applied:

- The tail node acts as a virtual ground
- Each transistor sees $\vgs = v_\mathrm{in,dm}/2$
- $i_\mathrm{out} = \gm \cdot v_\mathrm{in,dm}/2 - (-\gm \cdot v_\mathrm{in,dm}/2) = \gm \cdot v_\mathrm{in,dm}$

$$G_\mathrm{m,dm} = \gm$$

**Common mode:** With $v_\mathrm{in,cm}$ applied to both inputs:

- The tail current source presents impedance $r_\mathrm{tail} = 1 / \gds[,tail]$
- Due to source degeneration: $G_\mathrm{m,cm} = \frac{\gm}{1 + \gm \cdot r_\mathrm{tail}} \approx \frac{1}{r_\mathrm{tail}}$

**Common-mode rejection ratio (CMRR):**
$$\text{CMRR} = \frac{G_\mathrm{m,dm}}{G_\mathrm{m,cm}} = \gm \cdot r_\mathrm{tail}$$
:::

::: {.callout-note title="Question 5.2 --- Input-Referred Offset" collapse="true"}
**Question:** Derive the input-referred offset voltage of a differential pair due to threshold voltage mismatch $\Delta\Vth$ and transconductance mismatch $\Delta\gm/\gm$.

**Solution:**

The input-referred offset voltage has two components:

$$V_\mathrm{os} = \sqrt{\sigma^2\{\Delta\Vth\} + \left(\frac{\VGS - \Vth}{2}\right)^2 \cdot \sigma^2\left\{\frac{\Delta\gm}{\gm}\right\}}$$

Or equivalently:
$$V_\mathrm{os} = \sqrt{\sigma^2\{\Delta\Vth\} + \left(\frac{V_{od}}{2}\right)^2 \cdot \sigma^2\left\{\frac{\Delta(W/L)}{(W/L)}\right\}}$$

**To minimize offset:**

- Use large device area (mismatch $\propto 1 / \sqrt{WL}$)
- Use moderate $\gmid$ (not too low overdrive)
- Match layout carefully (common-centroid, dummy devices)
:::

---

### Basic 5-Transistor OTA

::: {.callout-note title="Question 6.1 --- DC Gain Derivation" collapse="true"}
**Question:** Derive the dc voltage gain of an unloaded basic 5-transistor OTA with differential pair ($M_1$, $M_2$), current mirror load ($M_3$, $M_4$), and tail current source ($M_5$).

**Solution:**

The small-signal analysis yields:

$$A_0 = \frac{v_\mathrm{out}}{v_\mathrm{in,dm}} = \frac{\gm[1,2]}{\gds[2] + \gds[4]}$$

where:

- $\gm[1,2]$ is the transconductance of the input transistors
- $\gds[2]$ is the output conductance of the NMOS input transistor
- $\gds[4]$ is the output conductance of the PMOS load transistor

This can be rewritten as:
$$A_0 = \frac{\gm[1,2]}{\gds[2]} \cdot \frac{1}{1 + \gds[4]/\gds[2]} = \frac{(\gmgds)_{1,2}}{1 + \gds[4]/\gds[2]}$$

For equal output conductances: $A_0 \approx \frac{(\gmgds)_{1,2}}{2}$
:::

::: {.callout-note title="Question 6.2 --- Bandwidth and GBW" collapse="true"}
**Question:** For a 5T-OTA driving a load capacitance $C_\mathrm{L}$, derive the dominant pole frequency and the gain-bandwidth product (GBW).

**Solution:**

**Dominant pole:** The output node has total capacitance $C_\mathrm{L}$ (assuming $C_\mathrm{L} \gg$ parasitic capacitances) and total conductance $\gds[2] + \gds[4]$:

$$f_\mathrm{p} = \frac{\gds[2] + \gds[4]}{2\pi C_\mathrm{L}}$$

**Gain-bandwidth product:**
$$\text{GBW} = A_0 \cdot f_\mathrm{p} = \frac{\gm[1,2]}{\gds[2] + \gds[4]} \cdot \frac{\gds[2] + \gds[4]}{2\pi C_\mathrm{L}} = \frac{\gm[1,2]}{2\pi C_\mathrm{L}}$$

Note that GBW is independent of the output conductances and depends only on $\gm$ and $C_\mathrm{L}$.

**Design implication:** For a given GBW requirement and load capacitance:
$$\gm[1,2] = 2\pi \cdot \text{GBW} \cdot C_\mathrm{L}$$
:::

::: {.callout-note title="Question 6.3 --- Unity-Gain Buffer Accuracy" collapse="true"}
**Question:** A 5T-OTA with dc gain $A_0 = 50\,\text{dB}$ is configured as a unity-gain buffer. Calculate the closed-loop gain error.

**Solution:**

For a unity-gain buffer (100% feedback):
$$\frac{V_\mathrm{out}}{V_\mathrm{in}} = \frac{A_0}{1 + A_0}$$

With $A_0 = 50\,\text{dB} = 316$:
$$\frac{V_\mathrm{out}}{V_\mathrm{in}} = \frac{316}{317} = 0.9968$$

**Gain error:**
$$\epsilon = 1 - \frac{A_0}{1 + A_0} = \frac{1}{1 + A_0} \approx \frac{1}{A_0} = \frac{1}{316} = 0.32\%$$

For higher accuracy, the dc gain must be increased (e.g., using cascode structures).
:::

---

### Improved (Telescopic) OTA

::: {.callout-note title="Question 7.1 --- Gain Enhancement with Cascodes" collapse="true"}
**Question:** How does adding cascode transistors to a 5T-OTA improve the dc gain? Derive the new gain expression.

**Solution:**

With cascode transistors ($M_\mathrm{2C}$, $M_\mathrm{4C}$) added:

$$A_0 = \frac{\gm[1,2]}{g_\mathrm{out,n} + g_\mathrm{out,p}}$$

where:
$$g_\mathrm{out,n} = \gds[2] \cdot \frac{\gds[,2C]}{\gm[,2C]} \quad \text{and} \quad g_\mathrm{out,p} = \gds[4] \cdot \frac{\gds[,4C]}{\gm[,4C]}$$

Therefore:
$$A_0 \approx \frac{\gm[1,2]}{\gds[2] \cdot \frac{\gds[,2C]}{\gm[,2C]} + \gds[4] \cdot \frac{\gds[,4C]}{\gm[,4C]}}$$

If all transistors have similar $\gmgds$:
$$A_0 \approx \frac{(\gmgds)^2}{2}$$

**Gain improvement:** Factor of $\gmgds$ compared to simple 5T-OTA.
:::

::: {.callout-note title="Question 7.2 --- Output Swing" collapse="true"}
**Question:** What is the output voltage swing limitation of a telescopic OTA? Compare with a folded-cascode topology.

**Solution:**

**Telescopic OTA output swing:**
$$V_\mathrm{out,max} = \VDD - V_\mathrm{ds,sat,M4} - V_\mathrm{ds,sat,M4C}$$
$$V_\mathrm{out,min} = V_\mathrm{ds,sat,M2} + V_\mathrm{ds,sat,M2C} + V_\mathrm{ds,sat,M5C} + V_\mathrm{ds,sat,M5}$$

Total swing: $\VDD - 6 \cdot V_\mathrm{ds,sat}$

**Folded-cascode OTA output swing:**
$$V_\mathrm{out,max} = \VDD - 2 \cdot V_\mathrm{ds,sat}$$
$$V_\mathrm{out,min} = 2 \cdot V_\mathrm{ds,sat}$$

Total swing: $\VDD - 4 \cdot V_\mathrm{ds,sat}$

**Key difference:** The folded-cascode OTA allows a higher output swing and has a wider input common-mode range at the cost of increased power consumption; the telescopic OTA has limited input common-mode range and smaller swing, but only one current path.
:::

---

### Cascode Stage

::: {.callout-note title="Question 8.1 --- Output Impedance" collapse="true"}
**Question:** Derive the output impedance looking into the drain of a cascode transistor, assuming the source is connected to a current source with output resistance $r_\mathrm{ds,CS}$.

**Solution:**

Using small-signal analysis with test voltage $v_\mathrm{test}$ at the drain:

$$g_\mathrm{out} = \frac{i_\mathrm{test}}{v_\mathrm{test}} = \frac{\gds \cdot G_\mathrm{S}}{G_\mathrm{S} + \gm + \gds}$$

where $G_\mathrm{S} = 1/r_\mathrm{ds,CS} = \gds[,CS]$ is the source conductance.

For $\gm \gg \gds$ and $\gm \gg G_\mathrm{S}$:
$$g_\mathrm{out} \approx \frac{\gds \cdot G_\mathrm{S}}{\gm} = \gds[,CS] \cdot \frac{\gds}{\gm}$$

Therefore:
$$r_\mathrm{out} = \frac{1}{g_\mathrm{out}} = r_\mathrm{ds,CS} \cdot \frac{\gm}{\gds} = r_\mathrm{ds,CS} \cdot (\gmgds)$$

**Conclusion:** The cascode increases the output impedance by a factor equal to the intrinsic gain ($\gmgds$).
:::

::: {.callout-note title="Question 8.2 --- Input Impedance" collapse="true"}
**Question:** Calculate the input impedance looking into the source of a cascode transistor when its drain is connected to a low-impedance load.

**Solution:**

With drain shorted to ac ground ($G_\mathrm{D} \to \infty$):

$$g_\mathrm{in} = \frac{(\gm + \gds) \cdot G_\mathrm{D}}{\gds + G_\mathrm{D}} \approx \gm + \gds \approx \gm$$

Therefore: $Z_\mathrm{in} \approx 1 / \gm$

This low input impedance makes the cascode an effective "current buffer" that isolates the high-impedance current source from the output node variations.
:::

---

### Biasing and Bandgap Reference

::: {.callout-note title="Question 9.1 --- Bandgap Principle" collapse="true"}
**Question:** Explain the principle of a bandgap voltage reference. Why does the output voltage equal approximately 1.2 V?

**Solution:**

A bandgap reference combines two voltages with opposite temperature coefficients, usually derived from a bipolar transistor:

1. **$\VBE$ (CTAT):** $\frac{\partial \VBE}{\partial T} \approx -2\,\text{mV/K} < 0$

2. **$\Delta\VBE$ (PTAT):** $\Delta\VBE = \frac{kT}{q} \cdot \ln\left(\frac{J_1}{J_2}\right)$, where $\frac{\partial(\Delta\VBE)}{\partial T} = \frac{k}{q} \cdot \ln\left(\frac{J_1}{J_2}\right) > 0$

**Reference voltage:**
$$V_\mathrm{ref} = \VBE + K \cdot \Delta\VBE$$

where $K$ is chosen such that the temperature coefficients cancel:
$$\frac{\partial V_\mathrm{ref}}{\partial T} = \frac{\partial \VBE}{\partial T} + K \cdot \frac{\partial(\Delta\VBE)}{\partial T} = 0$$

At the zero-TC point, $V_\mathrm{ref}$ equals the extrapolated bandgap voltage of silicon at 0 K:
$$V_\mathrm{ref} = V_\mathrm{g0} \approx 1.205\,\text{V}$$
:::

::: {.callout-note title="Question 9.2 --- PTAT Current" collapse="true"}
**Question:** Design a PTAT (Proportional To Absolute Temperature) current source. What determines the temperature coefficient?

**Solution:**

A PTAT current is generated by forcing $\Delta\VBE$ across a resistor:

$$I_\mathrm{PTAT} = \frac{\Delta\VBE}{R} = \frac{kT}{qR} \cdot \ln\left(\frac{J_1}{J_2}\right) = \frac{kT}{qR} \cdot \ln(N)$$

where $N = J_1/J_2$ is the current density ratio (often implemented by area ratio).

**Temperature coefficient:**
$$\frac{\partial I_\mathrm{PTAT}}{\partial T} = \frac{k \ln(N)}{qR}$$

$$\frac{1}{I_\mathrm{PTAT}}\frac{\partial I_\mathrm{PTAT}}{\partial T} = \frac{1}{T} \approx +3300\,\text{ppm/K at 300 K}$$

The TC is determined by:

- Current density ratio $N$ (affects magnitude)
- Resistor value $R$ (affects magnitude)
- Temperature coefficient of $R$ (should be low for accurate PTAT behavior)
:::

---

### Noise Analysis

::: {.callout-note title="Question 10.1 --- MOSFET Thermal Noise" collapse="true"}
**Question:** Write the expression for the thermal noise current of a MOSFET in saturation. What is the noise excess factor $\gamma$?

**Solution:**

**Thermal noise current spectral density:**
$$\overline{i_\mathrm{n}^2} = 4 k T \gamma g_{d0}\,\text{[A}^2\text{/Hz]}$$

where:

- $k = 1.38 \times 10^{-23}\,\text{J/K}$ is Boltzmann's constant
- $T$ is absolute temperature
- $\gamma$ is the noise excess factor
- $g_{d0}$ is the zero-bias drain conductance ($\approx \gm$ in saturation and $\approx \gds$ in triode)

**Noise excess factor $\gamma$:**

- Long-channel theory: $\gamma = 2/3$
- Short-channel devices: $\gamma > 2/3$ (can be 1--2 for deep submicron)
- Depends on bias point (increases at lower $\gmid$)

**Input-referred noise voltage:**
$$\overline{v_\mathrm{n,in}^2} = \frac{\overline{i_\mathrm{n}^2}}{\gm^2} = \frac{4 k T \gamma}{\gm}\,\text{[V}^2\text{/Hz]}$$
:::

::: {.callout-note title="Question 10.2 --- OTA Output Noise" collapse="true"}
**Question:** Derive the total output noise of a 5T-OTA in a unity-gain buffer configuration with load capacitance $C_\mathrm{L}$.

**Solution:**

The integrated output noise ($kT/C$ noise):
$$V_\mathrm{n,out,rms}^2 = \frac{kT}{C_\mathrm{L}} \left[ 2\gamma_{1,2} + 2\gamma_{3,4} \left(\frac{\gm[3,4]}{\gm[1,2]}\right)^2 \right]$$

**Analysis:**

1. Input pair ($M_1$, $M_2$): Each contributes $\gamma_{1,2}$, total factor $2 \gamma_{1,2}$
2. Load pair ($M_3$, $M_4$): Each contributes $\gamma_{3,4} \cdot (\gm[3,4]/\gm[1,2])^2$ when referred to the input

**To minimize noise:**

- Increase $C_\mathrm{L}$ (but reduces bandwidth; increase $\gm$ to compensate for a given GBW)
- Minimize $\gm[3,4]/\gm[1,2]$ ratio (keep load $\gm$ low)
- Use large input transistors (reduces flicker noise)
:::

---

### Mismatch and Variability

::: {.callout-note title="Question 11.1 --- Pelgrom's Law" collapse="true"}
**Question:** State Pelgrom's law for MOSFET threshold voltage mismatch. How should transistors be sized to achieve 1 mV offset in a differential pair (assuming $A_\mathrm{vth} = 5\,\text{mV} \cdot \mu\text{m}$)?

**Solution:**

**Pelgrom's law:**
$$\sigma \{ \Delta\Vth \} = \frac{A_\mathrm{vth}}{\sqrt{WL}}$$

where $A_\mathrm{vth}$ is a technology-dependent constant (typical: 3--10 mV·µm for modern CMOS).

**For 1 mV offset:**
With $A_\mathrm{vth} = 5\,\text{mV} \cdot \mu\text{m}$:

$$1\,\text{mV} = \frac{5\,\text{mV}\cdot\mu\text{m}}{\sqrt{WL}}$$

$$\sqrt{WL} = 5\,\mu\text{m} \Rightarrow WL = 25\,\mu\text{m}^2$$

For example: $W = 5\,\mu\text{m}$, $L = 5\,\mu\text{m}$ or $W = 10\,\mu\text{m}$, $L = 2.5\,\mu\text{m}$

**Note:** Using longer $L$ also improves intrinsic gain but reduces speed.
:::

::: {.callout-note title="Question 11.2 --- Monte Carlo Analysis" collapse="true"}
**Question:** Explain the difference between process corners (SS, TT, FF, etc.) and Monte Carlo mismatch simulation. When should each be used?

**Solution:**

**Process corners:**

- Model systematic variations across wafer/lot
- All transistors on a chip shift together
- Corners: SS (slow-slow), FF (fast-fast), TT (typical), SF, FS
- Used for: Worst-case timing, power, functionality

**Monte Carlo mismatch:**

- Models random variations between adjacent devices
- Each device varies independently
- Based on statistical distributions (Pelgrom)
- Used for: Offset, matching-critical circuits

**When to use:**

| Analysis                | Process Corners | Monte Carlo |
|-------------------------|:---------------:|:-----------:|
| Operating point range   | ✓               |             |
| Power consumption       | ✓               |             |
| Timing margins          | ✓               |             |
| Input offset            |                 | ✓           |
| Current mirror accuracy |                 | ✓           |
| CMRR, PSRR              | ✓               | ✓           |
| Yield estimation        | ✓               | ✓           |

**Best practice:** Combine both --- run Monte Carlo at each process corner.
:::

---

### Design Problems

::: {.callout-note title="Question 12.1 --- OTA Design" collapse="true"}
**Question:** Design a 5T-OTA to meet the following specifications using gm/ID methodology:

- GBW = 10 MHz with $C_L = 5\,\text{pF}$
- DC gain > 50 dB
- Power supply: $\VDD = 1.5\,\text{V}$
- Power consumption < 100 µW

**Solution:**

**Step 1: Calculate required $\gm$**
$$\gm = 2\pi \cdot GBW \cdot C_L = 2\pi \cdot 10\,\text{MHz} \cdot 5\,\text{pF} = 314\,\mu\text{S}$$

**Step 2: Choose $\gmid$ and calculate current**
For moderate speed/power trade-off, choose $\gmid = 15\,\text{V}^{-1}$:
$$\ID = \frac{\gm}{\gmid} = \frac{314\,\mu\text{S}}{15\,\text{V}^{-1}} = 21\,\mu\text{A}$$

Total tail current: $I_{tail} = 2 \times 21\,\mu\text{A} = 42\,\mu\text{A}$

Power: $P = \VDD \cdot I_{tail} = 1.5\,\text{V} \times 42\,\mu\text{A} = 63\,\mu\text{W}$ ✓

**Step 3: Check DC gain requirement**
Required: $A_0 > 50\,\text{dB} = 316$

$$A_0 = \frac{\gm}{\gds[2] + \gds[4]} = \frac{(\gmgds)}{2}$$ (assuming equal $\gds$)

Need $\gmgds > 632$. From lookup tables at $\gmid = 15$, $L = 1\,\mu\text{m}$: $\gmgds \approx 100$

**Not sufficient!** Options:

- Increase L to 3--5 µm (increases $\gmgds$ to ~300--500)
- Use cascode topology
- Accept lower gain

**Step 4: Size transistors**
Using lookup tables: $\ID/W$ at $\gmid = 15$, $L = 3\,\mu\text{m}$ ≈ 0.5 µA/µm

$$W_{1,2} = \frac{\ID}{\ID/W} = \frac{21\,\mu\text{A}}{0.5\,\mu\text{A}/\mu\text{m}} = 42\,\mu\text{m}$$
:::

::: {.callout-note title="Question 12.2 --- Current Mirror Design" collapse="true"}
**Question:** Design a cascode current mirror to provide $I_{out} = 50\,\mu\text{A}$ from $I_{ref} = 10\,\mu\text{A}$. Minimize the output compliance voltage while achieving $r_{out} > 10\,\text{M}\Omega$.

**Solution:**

**Current ratio:** $I_{out}/I_{ref} = 5$

**Step 1: Choose $\gmid$ for minimum $V_{ds,sat}$**
High $\gmid = 18\,\text{V}^{-1}$: $V_{ds,sat} \approx 2/18 = 111\,\text{mV}$

**Step 2: Calculate required $\gmgds$**
For simple current mirror: $r_{out} = 1/\gds$
Required: $r_{out} > 10\,\text{M}\Omega$ at $\ID = 50\,\mu\text{A}$
$\gds < 100\,\text{nS}$, so $\gm > \gds \cdot (\gmgds)$

At $\gmid = 18$: $\gm = 18 \times 50\,\mu\text{A} = 900\,\mu\text{S}$
Required $\gmgds > 900\,\mu\text{S} / 100\,\text{nS} = 9000$

This is too high for a single device → need cascode!

**Step 3: Cascode design**
With cascode: $r_{out} \approx \gm[,casc] \cdot r_{ds,casc} \cdot r_{ds,main} \approx (\gmgds)^2 / \gm$
For $\gmgds = 100$ (achievable with L = 1 µm) at $\gm = 900\,\mu\text{S}$:
$r_{out} = 100^2 / 900\,\mu\text{S} = 10000 / 0.0009\,\text{S} \approx 11\,\text{M}\Omega$

This meets the requirement of $r_{out} > 10\,\text{M}\Omega$ ✓

**Conclusion:** A standard cascode current mirror with $L \approx 1\,\mu\text{m}$ achieving $\gmgds \approx 100$ is sufficient.

**Step 4: Minimum output voltage (high-swing)**
$V_{out,min} = 2 \times V_{ds,sat} \approx 2 \times 111\,\text{mV} = 222\,\text{mV}$
:::

::: {.callout-note title="Question 12.3 --- Common-Source Amplifier" collapse="true"}
**Question:** Design a common-source amplifier for a 50 Ω measurement system with voltage gain $|A_v| = 10$ (20 dB). The amplifier should be matched to 50 Ω at input and output.

**Solution:**

**Matching conditions:**

- Input: $R_{in} = R_1 = 50\,\Omega$ (external resistor)
- Output: $R_{load,eff} = R_L \| R_{out} = 50\,\Omega \| 50\,\Omega = 25\,\Omega$

**Voltage gain:**
$$A_v = -\gm \cdot R_{load,eff} = -\gm \times 25\,\Omega$$

For $|A_v| = 10$:
$$\gm = \frac{10}{25\,\Omega} = 400\,\text{mS}$$

**This is very high!** At $\gmid = 10$: $\ID = 40\,\text{mA}$ (excessive)

**Alternative approach:** Use source degeneration

With $R_s$ source degeneration:
$$A_v = \frac{-\gm R_{load,eff}}{1 + \gm R_s}$$

Choose $\gm = 40\,\text{mS}$, $R_s = 20\,\Omega$:
$$A_v = \frac{40\,\text{mS} \times 25\,\Omega}{1 + 40\,\text{mS} \times 20\,\Omega} = \frac{1}{1 + 0.8} = \frac{1}{1.8} \approx 0.56$$

The gain is less than unity because source degeneration reduces gain. To achieve $|A_v| = 10$ with 50 Ω matching requires either multiple stages, transformer matching, or a different topology (e.g., shunt-feedback amplifier).
:::

---

### Short Conceptual Questions

::: {.callout-note title="Question 13.1" collapse="true"}
**Question:** Why is it important to use "unit elements" when designing matched current mirrors?

**Solution:** Unit elements ensure:

1. Same device dimensions and orientation
2. Identical local environment (dummy devices)
3. Common-centroid layout possible
4. Gradient cancellation
5. Consistent parasitic effects
:::

::: {.callout-note title="Question 13.2" collapse="true"}
**Question:** What is the purpose of a tail current source in a differential pair?

**Solution:** The tail current source:

1. Sets the total bias current (operating point)
2. Provides high impedance to common-mode signals (improves CMRR)
3. Creates a virtual ground at the tail node for differential signals
4. Rejects power supply variations
:::

::: {.callout-note title="Question 13.3" collapse="true"}
**Question:** Why does the GBW of an OTA depend only on $\gm$ and $C_\mathrm{L}$, not on the output resistance?

**Solution:** 
$$\text{GBW} = A_0 \cdot f_\mathrm{p} = \frac{\gm}{g_\mathrm{out}} \cdot \frac{g_\mathrm{out}}{2\pi C_\mathrm{L}} = \frac{\gm}{2\pi C_\mathrm{L}}$$

The output conductance $g_\mathrm{out}$ appears in both the gain ($A_0 = \gm/g_\mathrm{out}$) and the pole frequency ($f_\mathrm{p} = g_\mathrm{out}/(2\pi C_\mathrm{L})$), so it cancels out. This is a fundamental property of single-pole systems.
:::

::: {.callout-note title="Question 13.4" collapse="true"}
**Question:** What is the advantage of a folded-cascode over a telescopic OTA?

**Solution:**

1. **Wider input common-mode range:** Input pair can swing from rail to rail (if NMOS and PMOS input stage are combined)
2. **Decoupled input and output dc levels:** More flexibility in biasing
3. **High output swing:** Using cascoded output transistors then swing is $\VDD - 4V_\mathrm{ds,sat}$

**Disadvantage:** Higher power consumption (needs additional bias current for folding transistors)
:::

::: {.callout-note title="Question 13.5" collapse="true"}
**Question:** Why is flicker noise more important in the input stage of an OTA than in the load stage?

**Solution:**

1. Input stage noise is multiplied by the full gain to the output
2. Load stage noise appears directly at output without gain multiplication
3. The input-referred noise from load devices is divided by the input stage gain
4. For good noise performance: Large input devices (more area → less flicker noise), smaller load devices acceptable
:::

::: {.callout-note title="Question 13.6" collapse="true"}
**Question:** Explain why the regulated cascode achieves higher output impedance than a simple cascode.

**Solution:**

In a regulated cascode, an auxiliary amplifier forces the drain voltage of the main current source transistor to be constant:

1. Simple cascode: $r_\mathrm{out} \approx \gm \cdot r_\mathrm{ds,casc} \cdot r_\mathrm{ds,main}$
2. Regulated cascode: $r_\mathrm{out} \approx A_\mathrm{aux} \cdot \gm \cdot r_\mathrm{ds,casc} \cdot r_\mathrm{ds,main}$

The auxiliary amplifier gain $A_\mathrm{aux}$ provides an additional multiplication factor, dramatically increasing output impedance. This is essentially applying negative feedback to stabilize the drain voltage.
:::
